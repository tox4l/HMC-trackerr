{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/musal/OneDrive/Desktop/HMC%20tracker/src/app/api/notifications/send/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport nodemailer from 'nodemailer';\r\nimport twilio from 'twilio';\r\n\r\nexport const runtime = 'nodejs';\r\n\r\ntype Payload = {\r\n  method: 'email' | 'sms';\r\n  to: string;\r\n  subject?: string;\r\n  message: string;\r\n};\r\n\r\nfunction getEmailTransporter() {\r\n  const host = process.env.SMTP_HOST;\r\n  const port = process.env.SMTP_PORT ? Number(process.env.SMTP_PORT) : undefined;\r\n  const user = process.env.SMTP_USER;\r\n  const pass = process.env.SMTP_PASS;\r\n\r\n  if (!host || !port || !user || !pass) {\r\n    return null;\r\n  }\r\n\r\n  return nodemailer.createTransport({\r\n    host,\r\n    port,\r\n    secure: port === 465,\r\n    auth: { user, pass },\r\n  });\r\n}\r\n\r\nfunction getTwilioClient() {\r\n  const sid = process.env.TWILIO_ACCOUNT_SID;\r\n  const token = process.env.TWILIO_AUTH_TOKEN;\r\n  const from = process.env.TWILIO_FROM;\r\n\r\n  if (!sid || !token || !from) {\r\n    return null;\r\n  }\r\n\r\n  return { client: twilio(sid, token), from };\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const payload = (await request.json()) as Payload;\r\n\r\n    if (!payload?.to || !payload?.message || !payload?.method) {\r\n      return NextResponse.json({ error: 'Invalid request payload' }, { status: 400 });\r\n    }\r\n\r\n    if (payload.method === 'email') {\r\n      const transporter = getEmailTransporter();\r\n      const from = process.env.SMTP_FROM;\r\n\r\n      if (!transporter || !from) {\r\n        return NextResponse.json({ error: 'Email provider not configured' }, { status: 400 });\r\n      }\r\n\r\n      await transporter.sendMail({\r\n        from,\r\n        to: payload.to,\r\n        subject: payload.subject || 'HMC Maintenance Reminder',\r\n        text: payload.message,\r\n      });\r\n    } else {\r\n      const twilioConfig = getTwilioClient();\r\n      if (!twilioConfig) {\r\n        return NextResponse.json({ error: 'SMS provider not configured' }, { status: 400 });\r\n      }\r\n\r\n      await twilioConfig.client.messages.create({\r\n        from: twilioConfig.from,\r\n        to: payload.to,\r\n        body: payload.message,\r\n      });\r\n    }\r\n\r\n    return NextResponse.json({ ok: true });\r\n  } catch (error) {\r\n    console.error('Notification send error:', error);\r\n    return NextResponse.json({ error: 'Failed to send notification' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AASvB,SAAS;IACP,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS;IAClC,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS,GAAG,OAAO,QAAQ,GAAG,CAAC,SAAS,IAAI;IACrE,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS;IAClC,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS;IAElC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM;QACpC,OAAO;IACT;IAEA,OAAO,mMAAU,CAAC,eAAe,CAAC;QAChC;QACA;QACA,QAAQ,SAAS;QACjB,MAAM;YAAE;YAAM;QAAK;IACrB;AACF;AAEA,SAAS;IACP,MAAM,MAAM,QAAQ,GAAG,CAAC,kBAAkB;IAC1C,MAAM,QAAQ,QAAQ,GAAG,CAAC,iBAAiB;IAC3C,MAAM,OAAO,QAAQ,GAAG,CAAC,WAAW;IAEpC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM;QAC3B,OAAO;IACT;IAEA,OAAO;QAAE,QAAQ,IAAA,0LAAM,EAAC,KAAK;QAAQ;IAAK;AAC5C;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,UAAW,MAAM,QAAQ,IAAI;QAEnC,IAAI,CAAC,SAAS,MAAM,CAAC,SAAS,WAAW,CAAC,SAAS,QAAQ;YACzD,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,IAAI,QAAQ,MAAM,KAAK,SAAS;YAC9B,MAAM,cAAc;YACpB,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS;YAElC,IAAI,CAAC,eAAe,CAAC,MAAM;gBACzB,OAAO,uLAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAgC,GAAG;oBAAE,QAAQ;gBAAI;YACrF;YAEA,MAAM,YAAY,QAAQ,CAAC;gBACzB;gBACA,IAAI,QAAQ,EAAE;gBACd,SAAS,QAAQ,OAAO,IAAI;gBAC5B,MAAM,QAAQ,OAAO;YACvB;QACF,OAAO;YACL,MAAM,eAAe;YACrB,IAAI,CAAC,cAAc;gBACjB,OAAO,uLAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAA8B,GAAG;oBAAE,QAAQ;gBAAI;YACnF;YAEA,MAAM,aAAa,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;gBACxC,MAAM,aAAa,IAAI;gBACvB,IAAI,QAAQ,EAAE;gBACd,MAAM,QAAQ,OAAO;YACvB;QACF;QAEA,OAAO,uLAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,uLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF"}}]
}